@page "/"
@using RuomRaCoffe.API.Services
@using RuomRaCoffe.API.Data.Entities
@using RuomRaCoffe.Shared.Dtos
@inject StaffService StaffService
@inject ISnackbar Snackbar

<PageTitle>Dashboard - Admin</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-4">
    <!-- Header -->
    <MudPaper Class="pa-4 mb-4" Elevation="1">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
            <MudStack>
                <MudText Typo="Typo.h4" Class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.Dashboard" Class="mr-3" />
                    Dashboard
                </MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    Welcome to RuomRaCoffe Admin Panel
                </MudText>
            </MudStack>
        </MudStack>
    </MudPaper>

    <!-- Statistics Cards -->
    @if (statistics != null)
    {
        <MudGrid Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-4" Elevation="1">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.People" Color="Color.Primary" Size="Size.Large" />
                        <MudText Typo="Typo.h4">@statistics.TotalStaff</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Total Staff</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-4" Elevation="1">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Work" Color="Color.Success" Size="Size.Large" />
                        <MudText Typo="Typo.h4">@statistics.CurrentlyWorking</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Currently Working</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-4" Elevation="1">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.BeachAccess" Color="Color.Warning" Size="Size.Large" />
                        <MudText Typo="Typo.h4">@statistics.OnLeave</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">On Leave</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudPaper Class="pa-4" Elevation="1">
                    <MudStack AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Schedule" Color="Color.Info" Size="Size.Large" />
                        <MudText Typo="Typo.h4">@statistics.AverageWorkHoursToday</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">Avg Hours Today</MudText>
                    </MudStack>
                </MudPaper>
            </MudItem>
        </MudGrid>
    }

    <!-- Quick Actions -->
    <MudPaper Class="pa-4" Elevation="1">
        <MudText Typo="Typo.h6" Class="mb-4">Quick Actions</MudText>
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           FullWidth="true"
                           StartIcon="@Icons.Material.Filled.PersonAdd"
                           OnClick="@(() => Navigation.NavigateTo("/staff/create"))">
                    Create Staff
                </MudButton>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Secondary"
                           FullWidth="true"
                           StartIcon="@Icons.Material.Filled.People"
                           OnClick="@(() => Navigation.NavigateTo("/staff"))">
                    View Staff
                </MudButton>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Success"
                           FullWidth="true"
                           StartIcon="@Icons.Material.Filled.Schedule"
                           OnClick="@(() => Navigation.NavigateTo("/staff/checkin"))">
                    Check In/Out
                </MudButton>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Info"
                           FullWidth="true"
                           StartIcon="@Icons.Material.Filled.Analytics"
                           OnClick="@(() => Navigation.NavigateTo("/staff"))">
                    View Reports
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudContainer>

@code {
    private StaffStatisticsDto? statistics;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadStatistics();
    }

    private async Task LoadStatistics()
    {
        try
        {
            isLoading = true;
            statistics = await StaffService.GetStaffStatisticsAsync();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading statistics: {ex.Message}", Severity.Error);
        }
        finally
        {
            isLoading = false;
        }
    }
} 